import{r as e,p as a,w as t,q as o,u as l,c as s,a as n,i as r,b as c,d as i,e as u,t as g,v as A,m as p,k as d,j as m}from"./index-CplmrVOw.js";import{o as w,e as h}from"./uni-app.es.DaIchM21.js";import{_ as v,c as I,p as f}from"./_plugin-vue_export-helper.B6xmZzhv.js";const k=v({__name:"index",setup(v){const k=e(!1),Q=e(""),b=e("url('/h5/static/images/Ellipse 1.png')"),y=e("url('/h5/static/images/Ellipse 2.png')"),D=e("杭州余杭"),E=a((()=>({backgroundImage:b.value,backgroundSize:"cover",backgroundPosition:"center"})));let x=null;function B(){Q.value=(new Date).toLocaleTimeString()}const C=()=>!!localStorage.getItem("token");async function q(){k.value=!0,b.value="url('/h5/static/images/Ellipse 2.png')",console.log("-------",b.value);const e=(new Date).toLocaleString();try{const e=localStorage.getItem("param"),a=await f({param:e});console.log("打卡响应:",a),0===a.code&&p({title:a.msg,icon:"error",duration:2e3})}catch(a){console.error("打卡失败:",a),p({title:a.message||"打卡失败，请重试。",icon:"error",duration:2e3})}console.log(`打卡成功，时间为: ${e}`),function(e){try{h.emit("punchData",{isPunched:!0,time:e}),console.log("发送打卡数据:",{isPunched:!0,punchTime:e})}catch(a){console.error("发送打卡数据失败:",a)}}(e)}return t((()=>C()),(e=>{e||(console.warn("用户已注销，重定向到登录页面"),o({url:"/pages/login/login"}))})),w((async()=>{if(!C())return console.error("用户未登录"),void o({url:"/pages/login/login"});B(),x=setInterval(B,1e3);const e=function(e){const a=window.location.href;console.log(a);const t=a.match(new RegExp(`[?&]${e}=([^&#]*)|(?:#|/).*?[?&]${e}=([^&#]*)`));return t?t[1]||t[2]:null}("param");console.log(e),e&&localStorage.setItem("param",e);try{const e=await I({param:localStorage.getItem("param")});k.value=Boolean(e.is_clock),D.value=e.point,k.value&&(b.value=y.value)}catch(a){console.error("获取打卡状态错误:",a)}})),l((()=>{clearInterval(x)})),(e,a)=>{const t=d,o=m,l=r;return c(),s(l,{class:"content"},{default:n((()=>[i(l,{class:"address"},{default:n((()=>[i(t,{style:{width:"24px",height:"24px"},src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAArVJREFUSEvFlt9LU2EYx5/nOQsKNnOm4rwr6Neoi4EUFV3osB926TakoqsQ6qKbiFCh5r+Q/QNhmc1JCFm5pYIXEaXlRUgS1IXbmEedkVC091cc51nHNXe2QDpweF8O53w/7/N9nud9D8I2X7jN+vD/AZPhSYf3sLcDFV4Ehk0ksRYZraCEt8BgwH3dPYCIaisnSkaw+Gxxn2JqEAU2AUcgjoACAY1xYw4MZjG7s7361q6vxSBbAtJj6b0qq96gwDpTzBjzICuM0ZLKyhPVXdVfCiFFAeFwmDqPd75DgT7ravNzSwS5ZwTIYXrmx8zJ5nAzt0KKAlJjqUsgod9qBzAYdgjH3fGR8fmWtpb99It6UWLQBIAhy+jK7h7nQ3tAPDUKHM6bAOAw1BBo6AAAazJxtW/1CUgMkDAiQACBL6u6nG22gGQ8uYQC95iWSC69jYHGT4X+rt1b8wqQH3O5ASBGy64eZ70tIPEqIQ1f16uGI0w9mtoRGgqJQkAkGNHOnD7LcguB9Vy4up1kC0jGkjoIrKWNklRZdcQT8swVApb7vh9yKDmXTz7DFVePq84WkIqlnoOEc+aHiqlhT9ATKsxB5v63QRIQNHNFnF44u50XbAELsYXLJKifBCkTAgyimtLuTDyd+Oz3+w8CQC9Jrd1auopheVWkIkpLu9LvQcDRzV2b62QzN/lu5ggao9npn9PHyuoDI8TEaOKAJrXXKLDGKrRJ3GgwsV5BGWJ4qup21XxZnWy+pI/oPiFlnCyQv7qZY0Zx1eq+6f5Q0V6Uh0R1nwT1B2JuE7kxAwJa3TeKixsaZZ0HelT3KabiJClnl3EzymC2tHjZAONF/bHuA0FxFFBDHDOUpVb3ta1XbjpQVgR5ux7oPlQYUdwRqr9qL15RBCbEOOEKS7HUuV5RBP/yg7DtgN/2i04oIhPw/gAAAABJRU5ErkJggg==",mode:"aspectFill"}),i(o,null,{default:n((()=>[u(g(D.value),1)])),_:1})])),_:1}),i(l,{onClick:q,class:"punch-button",style:A(E.value),disabled:k.value},{default:n((()=>[i(l,{style:{display:"grid","justify-items":"center"}},{default:n((()=>[i(o,null,{default:n((()=>[u(g(k.value?"已打卡":"打卡"),1)])),_:1}),i(o,{class:"time-text"},{default:n((()=>[u(g(Q.value),1)])),_:1})])),_:1})])),_:1},8,["style","disabled"])])),_:1})}}},[["__scopeId","data-v-4c77477a"]]);export{k as default};
